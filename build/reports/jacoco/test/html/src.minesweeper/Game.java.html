<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Game.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">final_project_tests</a> &gt; <a href="index.source.html" class="el_package">src.minesweeper</a> &gt; <span class="el_source">Game.java</span></div><h1>Game.java</h1><pre class="source lang-java linenums">package src.minesweeper;


import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.io.File;
import java.net.URISyntaxException;
import java.util.ArrayList;
import javax.swing.border.Border;
import javax.swing.border.EtchedBorder;
import java.sql.Date;

import javafx.util.Pair;
import javax.swing.border.TitledBorder;
//import Score.Time;



// This is the main controller class
public class Game implements MouseListener, ActionListener, WindowListener
{
    public static String dbPath;
    // &quot;playing&quot; indicates whether a game is running (true) or not (false).
    protected boolean playing;

    protected Board board;

    protected UI gui;
    
    protected Score score;
        
    //------------------------------------------------------------------//        

    public Game()
<span class="fc" id="L41">    {</span>
        // set db path
<span class="fc" id="L43">        String p = &quot;&quot;;</span>

        try
        {
<span class="fc" id="L47">            p = new File(Game.class.getProtectionDomain().getCodeSource().getLocation().toURI()).getPath() + &quot;\\db.accdb&quot;;</span>
<span class="fc" id="L48">            p = getClass().getResource(&quot;/../../resources/main/db.accdb&quot;).getPath();</span>
<span class="fc" id="L49">            p = new File(&quot;build/resources/main/db.accdb&quot;).getAbsolutePath();</span>
        }
<span class="nc" id="L51">        catch (URISyntaxException ex)</span>
        {
<span class="nc" id="L53">            System.out.println(&quot;Error loading database file.&quot;);</span>
<span class="fc" id="L54">        }</span>

<span class="fc" id="L56">        dbPath =   &quot;jdbc:ucanaccess://&quot; + p;</span>

        
<span class="fc" id="L59">        score = new Score();</span>
<span class="fc" id="L60">        score.populate();</span>
        
<span class="fc" id="L62">        UI.setLook(&quot;Nimbus&quot;);</span>
                        
<span class="fc" id="L64">        createBoard();</span>
        
<span class="fc" id="L66">        this.gui = new UI(board.getRows(), board.getCols(), board.getNumberOfMines());        </span>
<span class="fc" id="L67">        this.gui.setButtonListeners(this);</span>
                        
<span class="fc" id="L69">        this.playing = false;</span>
        
<span class="fc" id="L71">        gui.setVisible(true);</span>
        
<span class="fc" id="L73">        gui.setIcons();        </span>
<span class="fc" id="L74">        gui.hideAll();</span>
        
<span class="fc" id="L76">        resumeGame();</span>
<span class="fc" id="L77">    }</span>

    //-----------------Load Save Game (if any)--------------------------//
    
    public void resumeGame()
    {
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">        if(board.checkSave())</span>
        {
<span class="nc" id="L85">            ImageIcon question = new ImageIcon(getClass().getResource(&quot;/../../resources/main/question.png&quot;));</span>

<span class="nc" id="L87">            int option = JOptionPane.showOptionDialog(null, &quot;Do you want to continue your saved game?&quot;, </span>
                            &quot;Saved Game Found&quot;, JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE, question,null,null);

<span class="nc bnc" id="L90" title="All 4 branches missed.">            switch(option) </span>
            {
                case JOptionPane.YES_OPTION:      
      
                    //load board's state
<span class="nc" id="L95">                    Pair p = board.loadSaveGame();</span>
                    
                    //set button's images
<span class="nc" id="L98">                    setButtonImages();</span>
                    
                    //load timer's value                                        
<span class="nc" id="L101">                    gui.setTimePassed((int)p.getKey());</span>

                    //load mines value
<span class="nc" id="L104">                    gui.setMines((int)p.getValue());</span>
                    
<span class="nc" id="L106">                    gui.startTimer();</span>
                    
<span class="nc" id="L108">                    playing = true;</span>
<span class="nc" id="L109">                    break;</span>

                case JOptionPane.NO_OPTION:
<span class="nc" id="L112">                    board.deleteSavedGame();</span>
<span class="nc" id="L113">                    break;</span>
                    
                case JOptionPane.CLOSED_OPTION:
<span class="nc" id="L116">                    board.deleteSavedGame();</span>
                    break;
            }
        }
<span class="fc" id="L120">    }</span>


    //-------------------------------------------------//
    public void setButtonImages()
    {
<span class="nc" id="L126">        Cell cells[][] = board.getCells();</span>
<span class="nc" id="L127">        JButton buttons[][] = gui.getButtons();</span>
        
<span class="nc bnc" id="L129" title="All 2 branches missed.">        for( int y=0 ; y&lt;board.getRows() ; y++ ) </span>
        {
<span class="nc bnc" id="L131" title="All 2 branches missed.">            for( int x=0 ; x&lt;board.getCols() ; x++ ) </span>
            {
<span class="nc" id="L133">                buttons[x][y].setIcon(null);</span>
                
<span class="nc bnc" id="L135" title="All 2 branches missed.">                if (cells[x][y].getContent().equals(&quot;&quot;))</span>
                {
<span class="nc" id="L137">                    buttons[x][y].setIcon(gui.getIconTile());</span>
                }
<span class="nc bnc" id="L139" title="All 2 branches missed.">                else if (cells[x][y].getContent().equals(&quot;F&quot;))</span>
                {
<span class="nc" id="L141">                    buttons[x][y].setIcon(gui.getIconFlag());</span>
<span class="nc" id="L142">                    buttons[x][y].setBackground(Color.blue);	                    </span>
                }
<span class="nc bnc" id="L144" title="All 2 branches missed.">                else if (cells[x][y].getContent().equals(&quot;0&quot;))</span>
                {
<span class="nc" id="L146">                    buttons[x][y].setBackground(Color.lightGray);</span>
                }
                else
                {
<span class="nc" id="L150">                    buttons[x][y].setBackground(Color.lightGray);                    </span>
<span class="nc" id="L151">                    buttons[x][y].setText(cells[x][y].getContent());</span>
<span class="nc" id="L152">                    gui.setTextColor(buttons[x][y]);                                        </span>
                }
            }
        }
<span class="nc" id="L156">    }</span>
    
    
    //------------------------------------------------------------//
        
    public void createBoard()
    {
        // Create a new board        
<span class="fc" id="L164">        int mines = 10;</span>

<span class="fc" id="L166">        int r = 9;</span>
<span class="fc" id="L167">        int c = 9;</span>
                
<span class="fc" id="L169">        this.board = new Board(mines, r, c);        </span>
<span class="fc" id="L170">    }</span>
    

    //---------------------------------------------------------------//
    public void newGame()
    {                
<span class="nc" id="L176">        this.playing = false;        </span>
                                
<span class="nc" id="L178">        createBoard();</span>
        
<span class="nc" id="L180">        gui.interruptTimer();</span>
<span class="nc" id="L181">        gui.resetTimer();        </span>
<span class="nc" id="L182">        gui.initGame();</span>
<span class="nc" id="L183">        gui.setMines(board.getNumberOfMines());</span>
<span class="nc" id="L184">    }</span>
    //------------------------------------------------------------------------------//
    
    public void restartGame()
    {
<span class="nc" id="L189">        this.playing = false;</span>
        
<span class="nc" id="L191">        board.resetBoard();</span>
        
<span class="nc" id="L193">        gui.interruptTimer();</span>
<span class="nc" id="L194">        gui.resetTimer();        </span>
<span class="nc" id="L195">        gui.initGame();</span>
<span class="nc" id="L196">        gui.setMines(board.getNumberOfMines());</span>
<span class="nc" id="L197">    }</span>
        
    //------------------------------------------------------------------------------//    
    protected void endGame()
    {
<span class="fc" id="L202">        playing = false;</span>
<span class="fc" id="L203">        showAll();</span>

<span class="fc" id="L205">        score.save();</span>
<span class="fc" id="L206">    }</span>

    
    //-------------------------GAME WON AND GAME LOST ---------------------------------//
    
    public void gameWon()
    {
<span class="nc" id="L213">        score.incCurrentStreak();</span>
<span class="nc" id="L214">        score.incCurrentWinningStreak();</span>
<span class="nc" id="L215">        score.incGamesWon();</span>
<span class="nc" id="L216">        score.incGamesPlayed();</span>
        
<span class="nc" id="L218">        gui.interruptTimer();</span>
<span class="nc" id="L219">        endGame();</span>
        //----------------------------------------------------------------//
        
        
<span class="nc" id="L223">        JDialog dialog = new JDialog(gui, Dialog.ModalityType.DOCUMENT_MODAL);</span>
        
        //------MESSAGE-----------//
<span class="nc" id="L226">        JLabel message = new JLabel(&quot;Congratulations, you won the game!&quot;, SwingConstants.CENTER);</span>
                
        //-----STATISTICS-----------//
<span class="nc" id="L229">        JPanel statistics = new JPanel();</span>
<span class="nc" id="L230">        statistics.setLayout(new GridLayout(6,1,0,10));</span>
        
<span class="nc" id="L232">        ArrayList&lt;Score.Time&gt; bTimes = score.getBestTimes();</span>
        
<span class="nc bnc" id="L234" title="All 4 branches missed.">        if (bTimes.isEmpty() || (bTimes.get(0).getTimeValue() &gt; gui.getTimePassed()))</span>
        {
<span class="nc" id="L236">            statistics.add(new JLabel(&quot;    You have the fastest time for this difficulty level!    &quot;));</span>
        }
        
<span class="nc" id="L239">        score.addTime(gui.getTimePassed(), new Date(System.currentTimeMillis()));</span>
                
<span class="nc" id="L241">        JLabel time = new JLabel(&quot;  Time:  &quot; + Integer.toString(gui.getTimePassed()) + &quot; seconds            Date:  &quot; + new Date(System.currentTimeMillis()));</span>
        
<span class="nc" id="L243">        JLabel bestTime = new JLabel();</span>
        
        
<span class="nc bnc" id="L246" title="All 2 branches missed.">        if (bTimes.isEmpty())</span>
        {
<span class="nc" id="L248">            bestTime.setText(&quot;  Best Time:  ---                  Date:  ---&quot;);</span>
        }
        else
        {
<span class="nc" id="L252">            bestTime.setText(&quot;  Best Time:  &quot; + bTimes.get(0).getTimeValue() + &quot; seconds            Date:  &quot; + bTimes.get(0).getDateValue());</span>
        }
        
<span class="nc" id="L255">        JLabel gPlayed = new JLabel(&quot;  Games Played:  &quot; + score.getGamesPlayed());</span>
<span class="nc" id="L256">        JLabel gWon = new JLabel(&quot;  Games Won:  &quot; + score.getGamesWon());</span>
<span class="nc" id="L257">        JLabel gPercentage = new JLabel(&quot;  Win Percentage:  &quot; + score.getWinPercentage() + &quot;%&quot;);</span>
        
<span class="nc" id="L259">        statistics.add(time);</span>
<span class="nc" id="L260">        statistics.add(bestTime);</span>
<span class="nc" id="L261">        statistics.add(gPlayed);</span>
<span class="nc" id="L262">        statistics.add(gWon);</span>
<span class="nc" id="L263">        statistics.add(gPercentage);</span>
        
<span class="nc" id="L265">        Border loweredetched = BorderFactory.createEtchedBorder(EtchedBorder.LOWERED);        </span>
<span class="nc" id="L266">        statistics.setBorder(loweredetched);</span>
        
        
        //--------BUTTONS----------//
<span class="nc" id="L270">        JPanel buttons = new JPanel();</span>
<span class="nc" id="L271">        buttons.setLayout(new GridLayout(1,2,10,0));</span>
        
<span class="nc" id="L273">        JButton exit = new JButton(&quot;Exit&quot;);</span>
<span class="nc" id="L274">        JButton playAgain = new JButton(&quot;Play Again&quot;);</span>

        
<span class="nc" id="L277">        exit.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L278">            dialog.dispose();</span>
<span class="nc" id="L279">            windowClosing(null);</span>
<span class="nc" id="L280">        });        </span>
<span class="nc" id="L281">        playAgain.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L282">            dialog.dispose();            </span>
<span class="nc" id="L283">            newGame();</span>
<span class="nc" id="L284">        });        </span>
        
        
<span class="nc" id="L287">        buttons.add(exit);</span>
<span class="nc" id="L288">        buttons.add(playAgain);</span>
        
        //--------DIALOG-------------//
        
<span class="nc" id="L292">        JPanel c = new JPanel();</span>
<span class="nc" id="L293">        c.setLayout(new BorderLayout(20,20));</span>
<span class="nc" id="L294">        c.add(message, BorderLayout.NORTH);</span>
<span class="nc" id="L295">        c.add(statistics, BorderLayout.CENTER);</span>
<span class="nc" id="L296">        c.add(buttons, BorderLayout.SOUTH);</span>
        
<span class="nc" id="L298">        c.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
        
<span class="nc" id="L300">        dialog.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="nc" id="L301">        dialog.addWindowListener(new java.awt.event.WindowAdapter() {</span>
            @Override
            public void windowClosing(WindowEvent windowEvent) {
<span class="nc" id="L304">                    dialog.dispose();</span>
<span class="nc" id="L305">                    newGame();</span>
<span class="nc" id="L306">            }</span>
            }
        );

<span class="nc" id="L310">        dialog.setTitle(&quot;Game Won&quot;);</span>
<span class="nc" id="L311">        dialog.add(c);</span>
<span class="nc" id="L312">        dialog.pack();</span>
<span class="nc" id="L313">        dialog.setLocationRelativeTo(gui);</span>
<span class="nc" id="L314">        dialog.setVisible(true);                        </span>
<span class="nc" id="L315">    }</span>
    
    public void gameLost()
    {
<span class="fc" id="L319">        score.decCurrentStreak();</span>
<span class="fc" id="L320">        score.incCurrentLosingStreak();</span>
<span class="fc" id="L321">        score.incGamesPlayed();</span>
        
<span class="fc" id="L323">        gui.interruptTimer();</span>
        
<span class="fc" id="L325">        endGame();</span>
        
        //----------------------------------------------------------------//

<span class="fc" id="L329">        JDialog dialog = new JDialog(gui, Dialog.ModalityType.DOCUMENT_MODAL);</span>
        
        //------MESSAGE-----------//
<span class="fc" id="L332">        JLabel message = new JLabel(&quot;Sorry, you lost this game. Better luck next time!&quot;, SwingConstants.CENTER);</span>
                
        //-----STATISTICS-----------//
<span class="fc" id="L335">        JPanel statistics = new JPanel();</span>
<span class="fc" id="L336">        statistics.setLayout(new GridLayout(5,1,0,10));</span>
        
<span class="fc" id="L338">        JLabel time = new JLabel(&quot;  Time:  &quot; + Integer.toString(gui.getTimePassed()) + &quot; seconds&quot;);</span>
        
<span class="fc" id="L340">        JLabel bestTime = new JLabel();</span>
        
<span class="fc" id="L342">        ArrayList&lt;Score.Time&gt; bTimes = score.getBestTimes();</span>
        
<span class="pc bpc" id="L344" title="1 of 2 branches missed.">        if (bTimes.isEmpty())</span>
        {
<span class="fc" id="L346">            bestTime.setText(&quot;                        &quot;);</span>
        }
        else
        {
<span class="nc" id="L350">            bestTime.setText(&quot;  Best Time:  &quot; + bTimes.get(0).getTimeValue() + &quot; seconds            Date:  &quot; + bTimes.get(0).getDateValue());</span>
        }
        
<span class="fc" id="L353">        JLabel gPlayed = new JLabel(&quot;  Games Played:  &quot; + score.getGamesPlayed());</span>
<span class="fc" id="L354">        JLabel gWon = new JLabel(&quot;  Games Won:  &quot; + score.getGamesWon());</span>
<span class="fc" id="L355">        JLabel gPercentage = new JLabel(&quot;  Win Percentage:  &quot; + score.getWinPercentage() + &quot;%&quot;);</span>
        
<span class="fc" id="L357">        statistics.add(time);</span>
<span class="fc" id="L358">        statistics.add(bestTime);</span>
<span class="fc" id="L359">        statistics.add(gPlayed);</span>
<span class="fc" id="L360">        statistics.add(gWon);</span>
<span class="fc" id="L361">        statistics.add(gPercentage);</span>
        
<span class="fc" id="L363">        Border loweredetched = BorderFactory.createEtchedBorder(EtchedBorder.LOWERED);        </span>
<span class="fc" id="L364">        statistics.setBorder(loweredetched);</span>
        
        
        //--------BUTTONS----------//
<span class="fc" id="L368">        JPanel buttons = new JPanel();</span>
<span class="fc" id="L369">        buttons.setLayout(new GridLayout(1,3,2,0));</span>
        
<span class="fc" id="L371">        JButton exit = new JButton(&quot;Exit&quot;);</span>
<span class="fc" id="L372">        JButton restart = new JButton(&quot;Restart&quot;);</span>
<span class="fc" id="L373">        JButton playAgain = new JButton(&quot;Play Again&quot;);</span>

        
<span class="fc" id="L376">        exit.addActionListener((ActionEvent e) -&gt; {</span>
<span class="fc" id="L377">            dialog.dispose();</span>
<span class="nc" id="L378">            windowClosing(null);</span>
<span class="nc" id="L379">        });        </span>
<span class="fc" id="L380">        restart.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L381">            dialog.dispose();            </span>
<span class="nc" id="L382">            restartGame();</span>
<span class="nc" id="L383">        });        </span>
<span class="fc" id="L384">        playAgain.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L385">            dialog.dispose();            </span>
<span class="nc" id="L386">            newGame();</span>
<span class="nc" id="L387">        });        </span>
        
        
<span class="fc" id="L390">        buttons.add(exit);</span>
<span class="fc" id="L391">        buttons.add(restart);</span>
<span class="fc" id="L392">        buttons.add(playAgain);</span>
        
        //--------DIALOG-------------//
        
<span class="fc" id="L396">        JPanel c = new JPanel();</span>
<span class="fc" id="L397">        c.setLayout(new BorderLayout(20,20));</span>
<span class="fc" id="L398">        c.add(message, BorderLayout.NORTH);</span>
<span class="fc" id="L399">        c.add(statistics, BorderLayout.CENTER);</span>
<span class="fc" id="L400">        c.add(buttons, BorderLayout.SOUTH);</span>
        
<span class="fc" id="L402">        c.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
        
<span class="fc" id="L404">        dialog.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>
<span class="fc" id="L405">        dialog.addWindowListener(new java.awt.event.WindowAdapter() {</span>
            @Override
            public void windowClosing(WindowEvent windowEvent) {
<span class="nc" id="L408">                    dialog.dispose();</span>
<span class="nc" id="L409">                    newGame();</span>
<span class="nc" id="L410">            }</span>
            }
        );
        
<span class="fc" id="L414">        dialog.setTitle(&quot;Game Lost&quot;);</span>
<span class="fc" id="L415">        dialog.add(c);</span>
<span class="fc" id="L416">        dialog.pack();</span>
<span class="fc" id="L417">        dialog.setLocationRelativeTo(gui);</span>
<span class="nc" id="L418">        dialog.setVisible(true);        </span>
<span class="nc" id="L419">    }</span>
    
    
    //--------------------------------SCORE BOARD--------------------------------------//
    public void showScore()
    {
        //----------------------------------------------------------------//
                
<span class="nc" id="L427">        JDialog dialog = new JDialog(gui, Dialog.ModalityType.DOCUMENT_MODAL);</span>

        //-----BEST TIMES--------//
        
<span class="nc" id="L431">        JPanel bestTimes = new JPanel();</span>
<span class="nc" id="L432">        bestTimes.setLayout(new GridLayout(5,1));</span>
        
<span class="nc" id="L434">        ArrayList&lt;Score.Time&gt; bTimes = score.getBestTimes();</span>
        
<span class="nc bnc" id="L436" title="All 2 branches missed.">        for (int i = 0; i &lt; bTimes.size(); i++)</span>
        {
<span class="nc" id="L438">            JLabel t = new JLabel(&quot;  &quot; + bTimes.get(i).getTimeValue() + &quot;           &quot; + bTimes.get(i).getDateValue());            </span>
<span class="nc" id="L439">            bestTimes.add(t);</span>
        }
        
<span class="nc bnc" id="L442" title="All 2 branches missed.">        if (bTimes.isEmpty())</span>
        {
<span class="nc" id="L444">            JLabel t = new JLabel(&quot;                               &quot;);            </span>
<span class="nc" id="L445">            bestTimes.add(t);</span>
        }
        
<span class="nc" id="L448">        TitledBorder b = BorderFactory.createTitledBorder(&quot;Best Times&quot;);</span>
<span class="nc" id="L449">        b.setTitleJustification(TitledBorder.LEFT);</span>

<span class="nc" id="L451">        bestTimes.setBorder(b);</span>
                
        //-----STATISTICS-----------//
<span class="nc" id="L454">        JPanel statistics = new JPanel();</span>
        
<span class="nc" id="L456">        statistics.setLayout(new GridLayout(6,1,0,10));        </span>
        
<span class="nc" id="L458">        JLabel gPlayed = new JLabel(&quot;  Games Played:  &quot; + score.getGamesPlayed());</span>
<span class="nc" id="L459">        JLabel gWon = new JLabel(&quot;  Games Won:  &quot; + score.getGamesWon());</span>
<span class="nc" id="L460">        JLabel gPercentage = new JLabel(&quot;  Win Percentage:  &quot; + score.getWinPercentage() + &quot;%&quot;);</span>
<span class="nc" id="L461">        JLabel lWin = new JLabel(&quot;  Longest Winning Streak:  &quot; + score.getLongestWinningStreak());</span>
<span class="nc" id="L462">        JLabel lLose = new JLabel(&quot;  Longest Losing Streak:  &quot; + score.getLongestLosingStreak());</span>
<span class="nc" id="L463">        JLabel currentStreak = new JLabel(&quot;  Current Streak:  &quot; + score.getCurrentStreak());</span>

        
<span class="nc" id="L466">        statistics.add(gPlayed);</span>
<span class="nc" id="L467">        statistics.add(gWon);</span>
<span class="nc" id="L468">        statistics.add(gPercentage);</span>
<span class="nc" id="L469">        statistics.add(lWin);</span>
<span class="nc" id="L470">        statistics.add(lLose);</span>
<span class="nc" id="L471">        statistics.add(currentStreak);</span>
                        
<span class="nc" id="L473">        Border loweredetched = BorderFactory.createEtchedBorder(EtchedBorder.LOWERED);        </span>
<span class="nc" id="L474">        statistics.setBorder(loweredetched);</span>
        
        
        //--------BUTTONS----------//
<span class="nc" id="L478">        JPanel buttons = new JPanel();</span>
<span class="nc" id="L479">        buttons.setLayout(new GridLayout(1,2,10,0));</span>
        
<span class="nc" id="L481">        JButton close = new JButton(&quot;Close&quot;);</span>
<span class="nc" id="L482">        JButton reset = new JButton(&quot;Reset&quot;);</span>

        
<span class="nc" id="L485">        close.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L486">            dialog.dispose();</span>
<span class="nc" id="L487">        });        </span>
<span class="nc" id="L488">        reset.addActionListener((ActionEvent e) -&gt; {</span>
<span class="nc" id="L489">            ImageIcon question = new ImageIcon(getClass().getResource(&quot;/../../resources/main/question.png&quot;));</span>

<span class="nc" id="L491">            int option = JOptionPane.showOptionDialog(null, &quot;Do you want to reset all your statistics to zero?&quot;, </span>
                            &quot;Reset Statistics&quot;, JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE, question,null,null);

<span class="nc bnc" id="L494" title="All 2 branches missed.">            switch(option) </span>
            {
                case JOptionPane.YES_OPTION:      

<span class="nc" id="L498">                    score.resetScore();</span>
<span class="nc" id="L499">                    score.save();</span>
<span class="nc" id="L500">                    dialog.dispose();</span>
<span class="nc" id="L501">                    showScore();</span>
<span class="nc" id="L502">                    break;</span>

                case JOptionPane.NO_OPTION: 
                    break;
            }
<span class="nc" id="L507">        });        </span>
        
<span class="nc" id="L509">        buttons.add(close);</span>
<span class="nc" id="L510">        buttons.add(reset);</span>
        
<span class="nc bnc" id="L512" title="All 2 branches missed.">        if (score.getGamesPlayed() == 0)</span>
<span class="nc" id="L513">            reset.setEnabled(false);</span>
        
        //--------DIALOG-------------//
        
<span class="nc" id="L517">        JPanel c = new JPanel();</span>
<span class="nc" id="L518">        c.setLayout(new BorderLayout(20,20));</span>
<span class="nc" id="L519">        c.add(bestTimes, BorderLayout.WEST);</span>
<span class="nc" id="L520">        c.add(statistics, BorderLayout.CENTER);        </span>
<span class="nc" id="L521">        c.add(buttons, BorderLayout.SOUTH);</span>
        
<span class="nc" id="L523">        c.setBorder(BorderFactory.createEmptyBorder(5, 5, 5, 5));</span>
        
<span class="nc" id="L525">        dialog.setTitle(&quot;Minesweeper Statistics - Haris Muneer&quot;);</span>
<span class="nc" id="L526">        dialog.add(c);</span>
<span class="nc" id="L527">        dialog.pack();</span>
<span class="nc" id="L528">        dialog.setLocationRelativeTo(gui);</span>
<span class="nc" id="L529">        dialog.setVisible(true);                        </span>
<span class="nc" id="L530">    }</span>
    
    //------------------------------------------------------------------------------//
	
        
    // Shows the &quot;solution&quot; of the game.
    protected void showAll()
    {
        String cellSolution;
        
<span class="fc" id="L540">        Cell cells[][] = board.getCells();</span>
<span class="fc" id="L541">        JButton buttons[][] = gui.getButtons();</span>

<span class="fc bfc" id="L543" title="All 2 branches covered.">        for (int x=0; x&lt;board.getCols(); x++ ) </span>
        {
<span class="fc bfc" id="L545" title="All 2 branches covered.">            for (int y=0; y&lt;board.getRows(); y++ ) </span>
            {
<span class="fc" id="L547">                cellSolution = cells[x][y].getContent();</span>

                // Is the cell still unrevealed
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">                if( cellSolution.equals(&quot;&quot;) ) </span>
                {
<span class="fc" id="L552">                    buttons[x][y].setIcon(null);</span>
                    
                    // Get Neighbours
<span class="fc" id="L555">                    cellSolution = Integer.toString(cells[x][y].getSurroundingMines());</span>

                    // Is it a mine?
<span class="fc bfc" id="L558" title="All 2 branches covered.">                    if(cells[x][y].getMine()) </span>
                    {
<span class="fc" id="L560">                        cellSolution = &quot;M&quot;;</span>
                        
                        //mine
<span class="fc" id="L563">                        buttons[x][y].setIcon(gui.getIconMine());</span>
<span class="fc" id="L564">                        buttons[x][y].setBackground(Color.lightGray);                        </span>
                    }
                    else
                    {
<span class="fc bfc" id="L568" title="All 2 branches covered.">                        if(cellSolution.equals(&quot;0&quot;))</span>
                        {
<span class="fc" id="L570">                            buttons[x][y].setText(&quot;&quot;);                           </span>
<span class="fc" id="L571">                            buttons[x][y].setBackground(Color.lightGray);</span>
                        }
                        else
                        {
<span class="fc" id="L575">                            buttons[x][y].setBackground(Color.lightGray);</span>
<span class="fc" id="L576">                            buttons[x][y].setText(cellSolution);</span>
<span class="fc" id="L577">                            gui.setTextColor(buttons[x][y]);</span>
                        }
                    }
                }

                // This cell is already flagged!
<span class="nc bnc" id="L583" title="All 2 branches missed.">                else if( cellSolution.equals(&quot;F&quot;) ) </span>
                {
                    // Is it correctly flagged?
<span class="nc bnc" id="L586" title="All 2 branches missed.">                    if(!cells[x][y].getMine()) </span>
                    {
<span class="nc" id="L588">                        buttons[x][y].setBackground(Color.orange);</span>
                    }
                    else
<span class="nc" id="L591">                        buttons[x][y].setBackground(Color.green);</span>
                }
                
            }
        }
<span class="fc" id="L596">    }</span>
    

    //-------------------------------------------------------------------------//
    
    //-------------------------------------------------------------------------//    
    

    //-------------------------------------------------------------------------//

    
    //--------------------------------------------------------------------------//
    
    public boolean isFinished()
    {
<span class="nc" id="L611">        boolean isFinished = true;</span>
        String cellSolution;

<span class="nc" id="L614">        Cell cells[][] = board.getCells();</span>
        
<span class="nc bnc" id="L616" title="All 2 branches missed.">        for( int x = 0 ; x &lt; board.getCols() ; x++ ) </span>
        {
<span class="nc bnc" id="L618" title="All 2 branches missed.">            for( int y = 0 ; y &lt; board.getRows() ; y++ ) </span>
            {
                // If a game is solved, the content of each Cell should match the value of its surrounding mines
<span class="nc" id="L621">                cellSolution = Integer.toString(cells[x][y].getSurroundingMines());</span>
                
<span class="nc bnc" id="L623" title="All 2 branches missed.">                if(cells[x][y].getMine()) </span>
<span class="nc" id="L624">                    cellSolution = &quot;F&quot;;</span>

                // Compare the player's &quot;answer&quot; to the solution.
<span class="nc bnc" id="L627" title="All 2 branches missed.">                if(!cells[x][y].getContent().equals(cellSolution))</span>
                {
                    //This cell is not solved yet
<span class="nc" id="L630">                    isFinished = false;</span>
<span class="nc" id="L631">                    break;</span>
                }
            }
        }

<span class="nc" id="L636">        return isFinished;</span>
    }

 
    //Check the game to see if its finished or not
    protected void checkGame()
    {		
<span class="nc bnc" id="L643" title="All 2 branches missed.">        if(isFinished()) </span>
        {            
<span class="nc" id="L645">            gameWon();</span>
        }
<span class="nc" id="L647">    }</span>
   
    //----------------------------------------------------------------------/
       
    
    /*
     * If a player clicks on a zero, all surrounding cells (&quot;neighbours&quot;) must revealed.
     * This method is recursive: if a neighbour is also a zero, his neighbours must also be revealed.
     */
    public void findZeroes(int xCo, int yCo)
    {
        int neighbours;
        
<span class="nc" id="L660">        Cell cells[][] = board.getCells();</span>
<span class="nc" id="L661">        JButton buttons[][] = gui.getButtons();</span>

        // Columns
<span class="nc bnc" id="L664" title="All 2 branches missed.">        for(int x = board.makeValidCoordinateX(xCo - 1) ; x &lt;= board.makeValidCoordinateX(xCo + 1) ; x++) </span>
        {			
            // Rows
<span class="nc bnc" id="L667" title="All 2 branches missed.">            for(int y = board.makeValidCoordinateY(yCo - 1) ; y &lt;= board.makeValidCoordinateY(yCo + 1) ; y++) </span>
            {
                // Only unrevealed cells need to be revealed.
<span class="nc bnc" id="L670" title="All 2 branches missed.">                if(cells[x][y].getContent().equals(&quot;&quot;)) </span>
                {
                    // Get the neighbours of the current (neighbouring) cell.
<span class="nc" id="L673">                    neighbours = cells[x][y].getSurroundingMines();</span>

                    // Reveal the neighbours of the current (neighbouring) cell
<span class="nc" id="L676">                    cells[x][y].setContent(Integer.toString(neighbours));</span>

<span class="nc bnc" id="L678" title="All 2 branches missed.">                    if (!cells[x][y].getMine())</span>
<span class="nc" id="L679">                        buttons[x][y].setIcon(null);                        </span>
                    
                    // Is this (neighbouring) cell a &quot;zero&quot; cell itself?
<span class="nc bnc" id="L682" title="All 2 branches missed.">                    if(neighbours == 0)</span>
                    {                        
                        // Yes, give it a special color and recurse!
<span class="nc" id="L685">                        buttons[x][y].setBackground(Color.lightGray);</span>
<span class="nc" id="L686">                        buttons[x][y].setText(&quot;&quot;);</span>
<span class="nc" id="L687">                        findZeroes(x, y);</span>
                    }
                    else
                    {
                        // No, give it a boring gray color.
<span class="nc" id="L692">                        buttons[x][y].setBackground(Color.lightGray);</span>
<span class="nc" id="L693">                        buttons[x][y].setText(Integer.toString(neighbours));</span>
<span class="nc" id="L694">                        gui.setTextColor(buttons[x][y]);                        </span>
                    }
                }
            }
        }
<span class="nc" id="L699">    }</span>
    //-----------------------------------------------------------------------------//
    //This function is called when clicked on closed button or exit
    @Override
    public void windowClosing(WindowEvent e) 
    {
<span class="nc bnc" id="L705" title="All 2 branches missed.">        if (playing)</span>
        {
<span class="nc" id="L707">            ImageIcon question = new ImageIcon(getClass().getResource(&quot;/../../resources/main/question.png&quot;));</span>

<span class="nc" id="L709">            Object[] options = {&quot;Save&quot;,&quot;Don't Save&quot;,&quot;Cancel&quot;};</span>

<span class="nc" id="L711">            int quit = JOptionPane.showOptionDialog(null, &quot;What do you want to do with the game in progress?&quot;, </span>
                            &quot;New Game&quot;, JOptionPane.YES_NO_CANCEL_OPTION, JOptionPane.QUESTION_MESSAGE, question, options, options[2]);

<span class="nc bnc" id="L714" title="All 3 branches missed.">            switch(quit) </span>
            {
                //save
                case JOptionPane.YES_OPTION:
                    
<span class="nc" id="L719">                    gui.interruptTimer();</span>
<span class="nc" id="L720">                    score.save();</span>
                    
<span class="nc" id="L722">                    JDialog dialog = new JDialog(gui, Dialog.ModalityType.DOCUMENT_MODAL);</span>
<span class="nc" id="L723">                    JPanel panel = new JPanel();</span>
<span class="nc" id="L724">                    panel.setLayout(new BorderLayout());</span>
<span class="nc" id="L725">                    panel.setBorder(BorderFactory.createEmptyBorder(20, 20, 20, 20));</span>
<span class="nc" id="L726">                    panel.add(new JLabel(&quot;Saving.... Please Wait&quot;, SwingConstants.CENTER));</span>
<span class="nc" id="L727">                    dialog.add(panel);</span>
<span class="nc" id="L728">                    dialog.setTitle(&quot;Saving Game...&quot;);</span>
<span class="nc" id="L729">                    dialog.pack();</span>
<span class="nc" id="L730">                    dialog.setLocationRelativeTo(gui);                    </span>
<span class="nc" id="L731">                    dialog.setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);</span>
                    
<span class="nc" id="L733">                    SwingWorker&lt;Void, Void&gt; worker = new SwingWorker&lt;Void, Void&gt;(){</span>
                       @Override
                       protected Void doInBackground() throws Exception 
                       {
<span class="nc" id="L737">                            board.saveGame(gui.getTimePassed(), gui.getMines());                </span>
<span class="nc" id="L738">                            return null;</span>
                       }
                       
                       @Override
                       protected void done(){
<span class="nc" id="L743">                           dialog.dispose();                           </span>
<span class="nc" id="L744">                       }                       </span>
                    };
                            
<span class="nc" id="L747">                    worker.execute();</span>
<span class="nc" id="L748">                    dialog.setVisible(true);</span>
                                                            
<span class="nc" id="L750">                    System.exit(0);</span>
<span class="nc" id="L751">                    break;</span>
                
                //dont save                    
                case JOptionPane.NO_OPTION:
<span class="nc" id="L755">                    score.incGamesPlayed();</span>
<span class="nc" id="L756">                    score.save();</span>
<span class="nc" id="L757">                    System.exit(0);</span>
<span class="nc" id="L758">                    break;</span>
                    
                case JOptionPane.CANCEL_OPTION: break;
            }
<span class="nc" id="L762">        }</span>
        else
<span class="nc" id="L764">            System.exit(0);</span>
<span class="nc" id="L765">    }</span>
    
    //-----------------------------------------------------------------------//

    @Override
    public void actionPerformed(ActionEvent e) {        
<span class="nc" id="L771">        JMenuItem menuItem = (JMenuItem) e.getSource();</span>

<span class="nc bnc" id="L773" title="All 2 branches missed.">        if (menuItem.getName().equals(&quot;New Game&quot;))</span>
        {
<span class="nc bnc" id="L775" title="All 2 branches missed.">            if (playing)</span>
            {
<span class="nc" id="L777">                ImageIcon question = new ImageIcon(getClass().getResource(&quot;/../../resources/main/question.png&quot;));</span>

<span class="nc" id="L779">                Object[] options = {&quot;Quit and Start a New Game&quot;,&quot;Restart&quot;,&quot;Keep Playing&quot;};</span>
                
<span class="nc" id="L781">                int startNew = JOptionPane.showOptionDialog(null, &quot;What do you want to do with the game in progress?&quot;, </span>
                                &quot;New Game&quot;, JOptionPane.YES_NO_CANCEL_OPTION, JOptionPane.QUESTION_MESSAGE, question, options, options[2]);

<span class="nc bnc" id="L784" title="All 3 branches missed.">                switch(startNew) </span>
                {
                    case JOptionPane.YES_OPTION:      
                        
                        // Initialize the new game.
<span class="nc" id="L789">                        newGame();</span>
<span class="nc" id="L790">                        score.incGamesPlayed();</span>
<span class="nc" id="L791">                        score.save();</span>
<span class="nc" id="L792">                        break;</span>

                    case JOptionPane.NO_OPTION: 
<span class="nc" id="L795">                        score.incGamesPlayed();   </span>
<span class="nc" id="L796">                        score.save();</span>
<span class="nc" id="L797">                        restartGame();</span>
<span class="nc" id="L798">                        break;</span>
                    
                    case JOptionPane.CANCEL_OPTION: break;
                }
<span class="nc" id="L802">            }</span>
        }
        
<span class="nc bnc" id="L805" title="All 2 branches missed.">        else if (menuItem.getName().equals(&quot;Exit&quot;))</span>
        {
<span class="nc" id="L807">            windowClosing(null);</span>
        }
        
        //Statistics
        else
        {
<span class="nc" id="L813">            showScore();</span>
        }        
<span class="nc" id="L815">    }</span>
    
    
    //--------------------------------------------------------------------------//
        
    //Mouse Click Listener
    @Override
    public void mouseClicked(MouseEvent e)
    {
        // start timer on first click
<span class="nc bnc" id="L825" title="All 2 branches missed.">        if(!playing)</span>
        {
<span class="nc" id="L827">            gui.startTimer();</span>
<span class="nc" id="L828">            playing = true;</span>
        }
        
<span class="nc bnc" id="L831" title="All 2 branches missed.">        if (playing)</span>
        {
            //Get the button's name
<span class="nc" id="L834">            JButton button = (JButton)e.getSource();</span>

            // Get coordinates (button.getName().equals(&quot;x,y&quot;)).
<span class="nc" id="L837">            String[] co = button.getName().split(&quot;,&quot;);</span>

<span class="nc" id="L839">            int x = Integer.parseInt(co[0]);</span>
<span class="nc" id="L840">            int y = Integer.parseInt(co[1]);</span>

            // Get cell information.
<span class="nc" id="L843">            boolean isMine = board.getCells()[x][y].getMine();</span>
<span class="nc" id="L844">            int neighbours = board.getCells()[x][y].getSurroundingMines();</span>

            // Left Click
<span class="nc bnc" id="L847" title="All 2 branches missed.">            if (SwingUtilities.isLeftMouseButton(e)) </span>
            {
<span class="nc bnc" id="L849" title="All 2 branches missed.">                if (!board.getCells()[x][y].getContent().equals(&quot;F&quot;))</span>
                {
<span class="nc" id="L851">                    button.setIcon(null);</span>

                    //Mine is clicked.
<span class="nc bnc" id="L854" title="All 2 branches missed.">                    if(isMine) </span>
                    {  
                        //red mine
<span class="nc" id="L857">                        button.setIcon(gui.getIconRedMine());</span>
<span class="nc" id="L858">                        button.setBackground(Color.red);</span>
<span class="nc" id="L859">                        board.getCells()[x][y].setContent(&quot;M&quot;);</span>

<span class="nc" id="L861">                        gameLost();</span>
                    }
                    else 
                    {
                        // The player has clicked on a number.
<span class="nc" id="L866">                        board.getCells()[x][y].setContent(Integer.toString(neighbours));</span>
<span class="nc" id="L867">                        button.setText(Integer.toString(neighbours));</span>
<span class="nc" id="L868">                        gui.setTextColor(button);</span>

<span class="nc bnc" id="L870" title="All 2 branches missed.">                        if( neighbours == 0 ) </span>
                        {
                            // Show all surrounding cells.
<span class="nc" id="L873">                            button.setBackground(Color.lightGray);</span>
<span class="nc" id="L874">                            button.setText(&quot;&quot;);</span>
<span class="nc" id="L875">                            findZeroes(x, y);</span>
                        } 
                        else 
                        {
<span class="nc" id="L879">                            button.setBackground(Color.lightGray);</span>
                        }
                    }
                }
            }
            // Right Click
<span class="nc bnc" id="L885" title="All 2 branches missed.">            else if (SwingUtilities.isRightMouseButton(e)) </span>
            {
<span class="nc bnc" id="L887" title="All 2 branches missed.">                if(board.getCells()[x][y].getContent().equals(&quot;F&quot;)) </span>
                {   
<span class="nc" id="L889">                    board.getCells()[x][y].setContent(&quot;&quot;);</span>
<span class="nc" id="L890">                    button.setText(&quot;&quot;);</span>
<span class="nc" id="L891">                    button.setBackground(new Color(0,110,140));</span>

                    //simple blue

<span class="nc" id="L895">                    button.setIcon(gui.getIconTile());</span>
<span class="nc" id="L896">                    gui.incMines();</span>
                }
<span class="nc bnc" id="L898" title="All 2 branches missed.">                else if (board.getCells()[x][y].getContent().equals(&quot;&quot;)) </span>
                {
<span class="nc" id="L900">                    board.getCells()[x][y].setContent(&quot;F&quot;);</span>
<span class="nc" id="L901">                    button.setBackground(Color.blue);	</span>

<span class="nc" id="L903">                    button.setIcon(gui.getIconFlag());</span>
<span class="nc" id="L904">                    gui.decMines();</span>
                }
            }

<span class="nc" id="L908">            checkGame();</span>
        }
<span class="nc" id="L910">    }</span>

    //-------------------------RELATED TO SCORES----------------------//


    
    //---------------------EMPTY FUNCTIONS-------------------------------//
    @Override
    public void mousePressed(MouseEvent e) {
<span class="nc" id="L919">    }</span>

    @Override
    public void mouseReleased(MouseEvent e) {
<span class="nc" id="L923">    }</span>

    @Override
    public void mouseEntered(MouseEvent e) {
<span class="nc" id="L927">    }</span>

    @Override
    public void mouseExited(MouseEvent e) {
<span class="nc" id="L931">    }    </span>

    @Override
    public void windowOpened(WindowEvent e) {
<span class="fc" id="L935">    }</span>

    @Override
    public void windowClosed(WindowEvent e) {
<span class="nc" id="L939">    }</span>

    @Override
    public void windowIconified(WindowEvent e) {
<span class="nc" id="L943">    }</span>

    @Override
    public void windowDeiconified(WindowEvent e) {
<span class="nc" id="L947">    }</span>

    @Override
    public void windowActivated(WindowEvent e) {
<span class="fc" id="L951">    }</span>

    @Override
    public void windowDeactivated(WindowEvent e) {
<span class="fc" id="L955">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>